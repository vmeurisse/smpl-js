<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>smpl.js unit tests</title>
	<link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
</head>
<body>
	<div id="mocha"></div>
	<script>
		if (!Object.create) { // Simple test for bad browsers. May need some improvement
			document.write('<script src="../node_modules/es5-shim/es5-shim.js"><\/script>');
			document.write('<script src="../node_modules/es5-shim/es5-sham.js"><\/script>');
		}
		if (!window.JSON) {
			document.write('<script src="../node_modules/JSON/json2.js"><\/script>');
		}
	</script>
	<script src="../node_modules/requirejs/require.js"></script>
	<script src="../node_modules/mocha/mocha.js"></script>
	<script>mocha.setup('tdd')</script>
	<script>
		requirejs.config({
			packages: [{
				name: 'smpl',
				location: '../src',
				main: '../src/smpl.js'
			}]
		});
		require(['./testRunner'], function () {
			
			if (window.ActiveXObject || !window.postMessage) {
				(function() {
					var timeouts = [];
					process.nextTick = function(fn) {
						timeouts.push(fn);
						setTimeout(function() {
							if (timeouts.length) timeouts.shift()();
						}, 0);
					}
				})();
			}
			
			var runner = mocha.run();
			
			var failed = [];
			var ok = [];
			runner.on('fail', function(test, err){
				failed.push({
					title: test.title,
					fullTitle: test.fullTitle(),
					error: {
						message: err.message,
						stack: err.stack
					}
				});
			});

			runner.on('pass', function(test, err){
				ok.push({
					title: test.title,
 					fullTitle: test.fullTitle()
				});
			});
			runner.on('end', function(){
				window.mochaResults = {
					failed: failed,
					ok: ok
				};
			});
		});
	</script>
</body>
</html>
